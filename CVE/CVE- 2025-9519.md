# CVE-2025-9519: Easy Timer Shortcode `filter` Callable Resolution Leads to RCE

<img width="401" height="752" alt="Screenshot from 2025-11-01 16-12-20" src="https://github.com/user-attachments/assets/a9e37e7a-1530-4b5a-9de8-1c2a5178e68f" />

## Overview

**CVE-2025-9519** affects the **Easy Timer** WordPress plugin where the shortcode `filter` attribute is resolved to arbitrary callables. The implementation resolves tokens into callables (including PHP builtins) and invokes them sequentially on the shortcode content, allowing an authenticated editor to trigger dangerous builtins (e.g. `shell_exec`) and achieve remote code execution.

Discovered in 2025 during static and dynamic auditing of the plugin’s shortcode handling. The vendor patched the callable resolution logic in a later release (see References).

---

## Technical Details

The vulnerability stems from **improper control of generated code / callable invocation**: the plugin tokenizes a user-supplied `filter` string, resolves each token to either a plugin-prefixed function or an existing callable, then invokes the callable with the shortcode content as its argument. The code blacklists only `eval`, but accepts other PHP builtins, enabling RCE.

Root cause: accepting *any* existing callable rather than a safe, explicit whitelist of allowed transformation functions.

**Relevant failure modes:**
- Tokenization → tokens become candidate callables  
- Fallback logic → `easy_timer_<token>` OR global callable name  
- Invocation → `call_user_func($callable, $data)` (or equivalent) without whitelisting

---

## Methodology (how the bug was found)

1. **Changelog reconnaissance**  
   - Scanned plugin change logs and commit messages; found a mention that the `filter` attribute was hardened in a recent patch. This indicated user-supplied filter handling was worth inspecting.

<img width="448" height="182" alt="image" src="https://github.com/user-attachments/assets/68da08e6-38da-42e4-908d-1fa0f094b7f9" />


2. **Code search & static review**  
   - Searched the codebase for `filter`, `shortcode`, and `call_user_func` usage.  
   - Located the shortcode handler and the function that parses `filter` into tokens and resolves callables -> `filter-data.php`.

<img width="667" height="496" alt="image" src="https://github.com/user-attachments/assets/1b6a7af8-7c53-45b0-997c-dde2aaab4fb6" />

3. **Control-flow analysis**  
   - Traced how tokens are resolved: literal name → check `function_exists()` → fallback to `easy_timer_<name>`.  
   - Found explicit block only for `eval` and no whitelist of safe functions.

  <img width="566" height="731" alt="image" src="https://github.com/user-attachments/assets/810e79b1-3fe9-4078-a21c-7c8b74d79618" />

4. **Threat modeling**  
   - Enumerated dangerous PHP builtins (e.g., `system`, `exec`, `passthru`, `shell_exec`, `preg_replace` with `/e`) and verified they satisfy the `function_exists()` check.

5. **PoC construction (safe lab)**  
   - Built an isolated WordPress Docker instance, installed the vulnerable Easy Timer plugin, and created a post with a crafted shortcode that used a builtin as the filter and placed a command in the content.  
   - Confirmed command output surfaced in shortcode rendering.

<img width="635" height="201" alt="image" src="https://github.com/user-attachments/assets/1d43e57c-24b9-4758-baa1-2464a7148d95" />

<img width="666" height="356" alt="image" src="https://github.com/user-attachments/assets/539c0235-fd77-4a38-86a3-8225360e4b95" />

---

## Proof of Concept 

```php
<?php
// Research PoC: demonstrates the invocation pattern via shortcode.
// Replace with a safe command or echo for testing.

[countdown date=YYYY/MM/DD-hh:mm:ss filter=system_exec] ls -l [/countdown]
?>
